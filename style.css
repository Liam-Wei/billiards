:root {
    --bg-body: #F2F2F7; --bg-card: #FFFFFF;
    --c-primary: #007AFF; --c-gold-s: #FF9500; --c-gold-b: #AF52DE; --c-gold-9: #FFD60A; 
    --c-foul: #FF3B30; --c-let: #FF2D55;      
    --c-text: #1C1C1E; --c-text-muted: #8E8E93;
    --bg-muted: #E5E5EA; --border: #E5E5EA;
    --c-positive: #34C759; --c-negative: #FF3B30;
    --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
    background-color: var(--bg-body); margin: 0; padding: 0;
    height: 100dvh; width: 100vw;
    overflow: hidden; 
    display: flex; flex-direction: column;
    padding-top: max(10px, var(--safe-top)); padding-bottom: max(10px, var(--safe-bottom));
    box-sizing: border-box; user-select: none; -webkit-user-select: none;
    touch-action: none; 
}

/* --- Header --- */
header {
    flex-shrink: 0; height: 44px; display: grid; grid-template-columns: 1.2fr 0.6fr 1.2fr; align-items: center;
    padding: 0 16px; z-index: 10;
}
.header-left { display: flex; gap: 8px; justify-content: flex-start; }
.icon-btn {
    background: none; border: none; padding: 6px; color: var(--c-primary); 
    display: flex; align-items: center; cursor: pointer; border-radius: 50%;
}

/* 计时器样式 */
.timer-container {
    display: flex; justify-content: center; align-items: center; gap: 8px;
}
.timer-btn {
    background: none; border: none; padding: 0; color: #333; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
}
.timer-display {
    font-family: "SF Mono", monospace; font-size: 17px; font-weight: 700; color: #333;
    text-align: center; background: #E5E5EA; padding: 4px 12px; border-radius: 6px;
    min-width: 80px;
}
.timer-paused { color: #8E8E93; background: #F2F2F7; border: 1px solid #E5E5EA; }

.header-right { display: flex; justify-content: flex-end; }
.reset-btn { 
    border: none; background: none; color: var(--c-foul); font-size: 15px; font-weight: 600; 
    cursor: pointer;
}

/* --- 顶部信息栏 --- */
.info-bar {
    flex-shrink: 0; height: 85px; 
    margin: 4px 12px;
    display: grid; 
    grid-template-columns: 1.2fr 0.6fr 1.2fr;
    align-items: center;
    background: white;
    border-radius: 12px;
    padding: 0 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    gap: 4px;
}

.logs-area {
    display: flex; flex-direction: column; justify-content: center;
    font-size: 11px; line-height: 1.35; color: #8E8E93; text-align: left; overflow: hidden;
    height: 100%; padding: 4px 0;
}
.log-line { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.log-line.latest { color: var(--c-primary); font-weight: 600; font-size: 11.5px; }

.round-area {
    text-align: center; font-size: 26px; font-weight: 800; color: #333;
    display: flex; flex-direction: column; justify-content: center; align-items: center; 
    line-height: 1; height: 100%;
}
.round-area small { font-size: 10px; font-weight: 500; color: #8E8E93; margin-top: 2px; }

.leaderboard-area {
    display: flex; flex-direction: column; justify-content: center;
    font-size: 12px; color: #333; gap: 3px;
}
.lb-row { display: grid; grid-template-columns: 18px minmax(0, 40px) 48px; align-items: center; column-gap: 1px; justify-content: end; }
.lb-rank { width: auto; text-align: left; font-size: 12px; }
.lb-name { font-weight: 700; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #333; text-align: left; }
.lb-score { font-family: monospace; font-weight: 900; font-size: 14px; color: #000; text-align: right; font-variant-numeric: tabular-nums; }

/* --- 主区域 --- */
main {
    flex: 1; display: flex; flex-direction: column; justify-content: space-evenly; 
    padding: 2px 12px; overflow: hidden; gap: 6px;
}

.player-card {
    background: var(--bg-card); border-radius: 16px; 
    padding: 8px 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    display: flex; flex-direction: column; justify-content: center; transition: all 0.3s;
}

/* 1. 庄家 (第一张卡片) 样式 */
.player-card.is-dealer { 
    border: 1.5px solid rgba(255, 149, 0, 0.3); 
    background: #FFFCF5; /* 暖色背景 */
}

/* 2. 输家/闲家 (第二张卡片) 样式 */
.player-card.is-loser { 
    border: 1.5px solid rgba(142, 142, 147, 0.3); 
    background: #ECF1F6; /* 冷灰蓝背景 */
}

.card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.left-info { display: flex; align-items: center; gap: 8px; cursor: pointer; }
.rank-num {
    width: 20px; height: 20px; background: #E5E5EA; color: #666; 
    font-size: 12px; font-weight: 700; border-radius: 5px; 
    display: flex; align-items: center; justify-content: center;
}

/* 状态图标动画 */
.status-icon { font-size: 16px; margin-left: 4px; animation: popIn 0.3s; display: inline-block; }
@keyframes popIn { 0%{transform:scale(0);} 80%{transform:scale(1.2);} 100%{transform:scale(1);} }

.p-name { font-size: 16px; font-weight: 600; color: #333; }
.p-score { font-size: 28px; font-weight: 800; line-height: 1; font-variant-numeric: tabular-nums; }
.score-p { color: #34C759; } .score-n { color: #FF3B30; } .score-z { color: #1C1C1E; }

.btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 2px;}
.act-btn {
    border: none; border-radius: 9px; display: flex; flex-direction: column;
    align-items: center; justify-content: center; cursor: pointer; padding: 7px 0;
    background: #F2F2F7; position: relative; overflow: hidden;
}
.act-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }
.act-btn:active { transform: scale(0.96); }
.act-btn::after {
    content: ""; position: absolute; width: 100%; height: 100%; top: 0; left: 0;
    background: rgba(0,0,0,0.05); opacity: 0; transition: opacity 0.2s;
}
.act-btn:active::after { opacity: 1; }

.btn-t { font-size: 13px; font-weight: 600; margin-bottom: 0px; white-space: nowrap;}
.btn-s { font-size: 9px; opacity: 0.7; font-weight: 500; letter-spacing: -0.2px; white-space: nowrap; transform: scale(0.95); }

.b-norm { background: #E1F0FF; color: var(--c-primary); }
.b-sgold { background: #FFF3DC; color: var(--c-gold-s); }
.b-bgold { background: #F3E5F5; color: var(--c-gold-b); }
.b-gold9 { background: #FFFDE7; color: #9A7D0A; } 
.b-black { background: #3A3A3C; color: #FFF; }
.b-foul { background: #FFEEEE; color: var(--c-foul); }
.b-let { background: #FFF0F5; color: var(--c-let); }

/* --- Footer --- */
footer {
    flex-shrink: 0; display: flex; justify-content: space-between;
    padding: 8px 16px; gap: 12px; height: 44px;
}
.footer-btn {
    flex: 1; border-radius: 21px; display: flex; align-items: center; justify-content: center; gap: 6px;
    font-size: 14px; font-weight: 600; border: none; cursor: pointer;
}
.btn-undo { background: #FFF; color: #555; border: 1px solid #E5E5EA; }
.btn-save { background: #1C1C1E; color: #FFF; }

/* Modals */
.modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px);
    z-index: 100; display: none; opacity: 0; transition: opacity 0.25s;
    justify-content: center; align-items: center;
}
.modal-overlay.show { display: flex; opacity: 1; }
.center-box {
    background: #FFF; width: 300px; max-width: 90%; border-radius: 18px; 
    padding: 20px; text-align: center; transform: scale(0.9); transition: transform 0.2s;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-height: 80vh; overflow-y: auto;
}
.modal-overlay.show .center-box { transform: scale(1); }
.modal-input {
    width: 100%; box-sizing: border-box; padding: 12px; background: #F2F2F7; 
    border: none; border-radius: 12px; margin: 16px 0; text-align: center; font-size: 16px;
}
.setting-opt {
    background: #F2F2F7; padding: 10px; border-radius: 10px; margin-bottom: 8px;
    display: flex; justify-content: space-between; align-items: center; cursor: pointer;
    touch-action: manipulation;
}
.setting-opt.selected { background: #E1F0FF; border: 1px solid var(--c-primary); }

.player-card.tap-add { cursor: pointer; }
.player-card.tap-add:active { transform: scale(0.99); }
.cn8-card {
    border-radius: 18px;
    padding: 16px 16px;
    min-height: 118px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-shadow: 0 8px 18px rgba(0,0,0,0.06);
}
.cn8-layout { position: relative; width: 100%; height: 104px; }
.cn8-rank { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); }
.cn8-name {
    position: absolute;
    left: 56px;
    right: 32%;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.cn8-score {
    position: absolute;
    left: 75%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: 68px;
    font-weight: 950;
    line-height: 1;
    font-variant-numeric: tabular-nums;
}
.cn8-red {
    background: linear-gradient(135deg, #FF4D4D, #FF2D55);
    color: #FFF;
}
.cn8-blue {
    background: linear-gradient(135deg, #2E7BFF, #5856D6);
    color: #FFF;
}
.cn8-card .rank-num { background: rgba(255,255,255,0.18); color: rgba(255,255,255,0.95); }
.cn8-card .p-name { color: #FFF; font-size: 18px; font-weight: 800; }
.cn8-card .p-score { color: #FFF; font-size: 44px; font-weight: 900; }
.vs-divider {
    text-align: center;
    height: 118px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 76px;
    font-weight: 800;
    color: #8E8E93;
    letter-spacing: 2px;
    margin: 6px 0;
    font-style: italic;
    opacity: 0.35;
}

#summaryModal .center-box { 
    max-height: 90vh; 
    background: #FFFEFB;
    position: relative;
    overflow: visible;
    padding-bottom: 32px;
    box-shadow: 0 20px 44px rgba(0,0,0,0.22);
    transform-origin: top center;
    width: calc(100vw - 24px);
    max-width: none;
}
#summaryModal .center-box::after,
#summaryModal .center-box::before {
    content: none;
}
#summaryModal .result-row { padding: 18px 0; }
#summaryModal .res-name { font-size: 18px; font-weight: 900; }
#summaryModal .res-score { font-size: 22px; font-weight: 950; }
#summaryModal .stat-badge { font-size: 12px; padding: 6px 5px; border-radius: 8px; }

.btn-confirm { flex:1; padding:12px; border:none; border-radius:12px; background:var(--c-primary); color:#FFF; font-weight:600; transition: all 0.2s; }
.btn-confirm:disabled { background: #CCC; cursor: not-allowed; opacity: 0.7; }

/* Summary Receipt Style */
.receipt-header { border-bottom: none; padding-bottom: 6px; margin-bottom: 6px; position: relative; }
.receipt-header::after { content: none; }
.res-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-top: 6px; }
.stat-badge {
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; padding: 3px 2px; border-radius: 4px; 
    font-weight: 600; margin: 0; white-space: nowrap;
}
.sb-gold { background: #F3E5F5; color: var(--c-gold-b); }
.sb-win { background: #E1F0FF; color: var(--c-primary); }
.sb-foul { background: #FFEEEE; color: var(--c-foul); }
.result-row { display: flex; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid #F2F2F7; }

.summary-tabs {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}
.tab-btn {
    padding: 10px 0;
    border: 1px solid #E5E5EA;
    border-radius: 12px;
    background: #F6F6F8;
    font-weight: 750;
    font-size: 14px;
    color: #555;
    cursor: pointer;
    transition: all 0.18s;
}
.tab-btn.active {
    background: linear-gradient(120deg, rgba(0,122,255,0.1), rgba(255,149,0,0.08));
    border-color: rgba(0,122,255,0.38);
    color: #0A84FF;
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
}
.summary-view { text-align:left; }

.ach-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
}
.ach-item {
    background: var(--bg-muted);
    border-radius: 14px;
    padding: 12px;
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 12px;
}
.ach-icon {
    font-size: 22px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
}
.ach-title {
    font-size: 12px;
    color: var(--c-text-muted);
    margin-bottom: 2px;
    font-weight: 700;
    line-height: 1.2;
}
.ach-val {
    font-size: 15px;
    font-weight: 900;
    color: var(--c-text);
}
.ach-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 48px;
    gap: 4px;
}
.ach-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.help-row {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 8px;
    gap: 8px;
}
.help-btn {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    border: 1px solid #E5E5EA;
    background: #F6F6F8;
    color: #555;
    font-weight: 800;
    font-size: 14px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

#toast {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85); color: white; padding: 16px 24px; border-radius: 12px;
    font-size: 15px; font-weight: 600; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    z-index: 999; text-align: center; line-height: 1.4; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.role-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 18px;
    min-width: 18px;
    padding: 0 6px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 800;
    letter-spacing: -0.2px;
    line-height: 1;
}
.rb-dealer { background: rgba(255,149,0,0.18); color: #B25E00; border: 1px solid rgba(255,149,0,0.22); }
.rb-pos { background: rgba(142,142,147,0.15); color: #555; border: 1px solid rgba(142,142,147,0.18); }
.rb-lead { background: rgba(52,199,89,0.16); color: #0E7A2E; border: 1px solid rgba(52,199,89,0.2); }
.rb-low { background: rgba(255,59,48,0.12); color: #A60000; border: 1px solid rgba(255,59,48,0.18); }

#nameQuickList {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 0 0 14px;
    justify-content: center;
}
.name-chip {
    border: none;
    background: #F2F2F7;
    color: #333;
    padding: 8px 10px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 650;
    cursor: pointer;
    max-width: 100%;
}
.name-chip:active { transform: scale(0.98); }

#posterModal .center-box { width: 340px; max-height: 86vh; }
#posterImg { width: 100%; border-radius: 14px; display: block; background: #F2F2F7; }
.poster-btn-row { display:flex; gap:10px; margin-top:14px; }

.score-bump { animation: scoreBump 0.28s ease-out; }
@keyframes scoreBump { 0% { transform: translateY(0) scale(1); } 45% { transform: translateY(-4px) scale(1.08); } 100% { transform: translateY(0) scale(1); } }

.lead-flash { animation: leadFlash 0.55s ease-out; }
@keyframes leadFlash { 0% { box-shadow: 0 0 0 rgba(52,199,89,0); } 35% { box-shadow: 0 0 0 4px rgba(52,199,89,0.22); } 100% { box-shadow: 0 0 0 rgba(52,199,89,0); } }

.fly-point {
    position: fixed;
    z-index: 9999;
    pointer-events: none;
    font-family: ui-monospace, Menlo, monospace;
    font-weight: 900;
    font-variant-numeric: tabular-nums;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,0.78);
    color: #fff;
    transform: translate(-50%, -50%);
    will-change: transform, opacity;
}

.coin {
    position: fixed;
    z-index: 9998;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #FFF3B0, #FFD60A);
    box-shadow: 0 6px 14px rgba(0,0,0,0.22);
    pointer-events: none;
    animation: coinFall 900ms ease-in forwards;
}
@keyframes coinFall {
    0% { transform: translateY(-40px) rotate(0deg); opacity: 0; }
    15% { opacity: 1; }
    100% { transform: translateY(240px) rotate(260deg); opacity: 0; }
}

.confetti-star {
    position: fixed;
    z-index: 9999;
    width: 14px;
    height: 14px;
    background: #FFD60A;
    clip-path: polygon(50% 0%, 63% 35%, 98% 35%, 70% 57%, 82% 91%, 50% 72%, 18% 91%, 30% 57%, 2% 35%, 37% 35%);
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.2);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.18));
}
.confetti-ring {
    position: fixed;
    z-index: 9998;
    width: 6px;
    height: 6px;
    border: 2px solid rgba(255,214,10,0.55);
    border-radius: 50%;
    left: 50%;
    top: 18%;
    transform: translate(-50%, -50%);
    opacity: 0;
}
@keyframes starBurst {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(0.25) rotate(0deg); }
    60% { opacity: 1; }
    100% { opacity: 0; transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(0.8) rotate(340deg); }
}
@keyframes ringExpand {
    0% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
    80% { opacity: 0.2; }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(18); }
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg-body: #000000; --bg-card: #1C1C1E;
        --c-text: rgba(255,255,255,0.92); --c-text-muted: rgba(235,235,245,0.6);
        --bg-muted: #2C2C2E; --border: #2C2C2E;
    }
    body { background-color: var(--bg-body); }
    .timer-display { color: var(--c-text); background: var(--bg-muted); }
    .timer-paused { color: var(--c-text-muted); background: rgba(44,44,46,0.65); border: 1px solid var(--border); }
    .info-bar { background: var(--bg-card); box-shadow: 0 2px 10px rgba(0,0,0,0.35); }
    .round-area { color: var(--c-text); }
    .lb-name { color: var(--c-text); }
    .lb-score { color: var(--c-text); }
    .player-card { box-shadow: 0 8px 18px rgba(0,0,0,0.35); }
    .player-card.is-dealer { background: rgba(255,149,0,0.12); }
    .player-card.is-loser { background: rgba(142,142,147,0.10); }
    .rank-num { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7); }
    .p-name { color: var(--c-text); }
    .score-z { color: var(--c-text); }
    .act-btn { background: rgba(44,44,46,0.85); }
    .btn-undo { background: var(--bg-card); color: var(--c-text); border: 1px solid var(--border); }
    .modal-overlay { background: rgba(0,0,0,0.6); }
    .center-box { background: var(--bg-card); box-shadow: 0 14px 34px rgba(0,0,0,0.55); }
    .modal-input { background: var(--bg-muted); color: var(--c-text); }
    .setting-opt { background: rgba(44,44,46,0.85); }
    .setting-opt.selected { background: rgba(0,122,255,0.18); }
    .name-chip { background: rgba(44,44,46,0.85); color: var(--c-text); }
    .result-row { border-bottom: 1px solid rgba(255,255,255,0.06); }
    .receipt-header { border-bottom: 2px dashed rgba(255,255,255,0.18); }
    #posterImg { background: var(--bg-muted); }
}
